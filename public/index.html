<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Global Chat</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #f4f4f9;
  }

  h2 {
    margin-top: 20px;
    color: #333;
  }

  #loginSection {
    width: 90%;
    max-width: 500px;
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  #loginSection input, #loginSection select, #loginSection button {
    padding: 10px;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  #loginSection button {
    background-color: #4CAF50;
    color: white;
    border: none;
    flex: 1 1 100px;
    cursor: pointer;
    transition: 0.2s;
  }

  #loginSection button:hover {
    background-color: #45a049;
  }

  #chatContainer {
    flex: 1;
    width: 90%;
    max-width: 800px;
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
    height: 70vh;
  }

  #chat {
    flex: 1;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    overflow-y: auto;
    background: #fff;
    margin-bottom: 10px;
    box-sizing: border-box;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  #inputContainer {
    display: flex;
    width: 100%;
    gap: 10px;
  }

  #msg {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }

  #sendBtn {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    background-color: #2196F3;
    color: white;
    cursor: pointer;
    transition: 0.2s;
  }

  #sendBtn:hover {
    background-color: #0b7dda;
  }

  .system-msg {
    font-style: italic;
    color: #555;
    margin: 4px 0;
  }

  .chat-message {
    margin: 4px 0;
  }

  .chat-message strong {
    color: #333;
  }

  /* Searchable dropdown styling */
  #lang {
    flex: 1 1 150px;
  }
</style>
</head>
<body>

<h2>Global Chat</h2>

<div id="loginSection">
  <input id="name" placeholder="Enter username" />
  <select id="lang">
    <!-- Languages will be populated dynamically -->
  </select>
  <button onclick="join()">Join</button>
</div>

<div id="chatContainer">
  <div id="chat"></div>
  <div id="inputContainer">
    <input id="msg" placeholder="Message" disabled />
    <button id="sendBtn" onclick="send()" disabled>Send</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const languages = {
  "af": "Afrikaans", "sq": "Albanian", "am": "Amharic", "ar": "Arabic", "hy": "Armenian",
  "az": "Azerbaijani", "eu": "Basque", "be": "Belarusian", "bn": "Bengali", "bs": "Bosnian",
  "bg": "Bulgarian", "ca": "Catalan", "ceb": "Cebuano", "zh": "Chinese", "co": "Corsican",
  "hr": "Croatian", "cs": "Czech", "da": "Danish", "nl": "Dutch", "en": "English",
  "eo": "Esperanto", "et": "Estonian", "fi": "Finnish", "fr": "French", "fy": "Frisian",
  "gl": "Galician", "ka": "Georgian", "de": "German", "el": "Greek", "gu": "Gujarati",
  "ht": "Haitian Creole", "ha": "Hausa", "haw": "Hawaiian", "he": "Hebrew", "hi": "Hindi",
  "hmn": "Hmong", "hu": "Hungarian", "is": "Icelandic", "ig": "Igbo", "id": "Indonesian",
  "ga": "Irish", "it": "Italian", "ja": "Japanese", "jw": "Javanese", "kn": "Kannada",
  "kk": "Kazakh", "km": "Khmer", "ko": "Korean", "ku": "Kurdish", "ky": "Kyrgyz",
  "lo": "Lao", "la": "Latin", "lv": "Latvian", "lt": "Lithuanian", "lb": "Luxembourgish",
  "mk": "Macedonian", "mg": "Malagasy", "ms": "Malay", "ml": "Malayalam", "mt": "Maltese",
  "mi": "Maori", "mr": "Marathi", "mn": "Mongolian", "my": "Myanmar (Burmese)", "ne": "Nepali",
  "no": "Norwegian", "ny": "Nyanja (Chichewa)", "ps": "Pashto", "fa": "Persian", "pl": "Polish",
  "pt": "Portuguese", "pa": "Punjabi", "ro": "Romanian", "ru": "Russian", "sm": "Samoan",
  "gd": "Scots Gaelic", "sr": "Serbian", "st": "Sesotho", "sn": "Shona", "sd": "Sindhi",
  "si": "Sinhala (Sinhalese)", "sk": "Slovak", "sl": "Slovenian", "so": "Somali", "es": "Spanish",
  "su": "Sundanese", "sw": "Swahili", "sv": "Swedish", "tl": "Tagalog (Filipino)", "tg": "Tajik",
  "ta": "Tamil", "te": "Telugu", "th": "Thai", "tr": "Turkish", "uk": "Ukrainian",
  "ur": "Urdu", "uz": "Uzbek", "vi": "Vietnamese", "cy": "Welsh", "xh": "Xhosa",
  "yi": "Yiddish", "yo": "Yoruba", "zu": "Zulu"
};

// Populate the dropdown
const langSelect = document.getElementById("lang");
for (const code in languages) {
  const option = document.createElement("option");
  option.value = code;
  option.textContent = languages[code];
  langSelect.appendChild(option);
}

let socket;
let loggedIn = false;
let myLang = "en";

function join() {
  const name = document.getElementById("name").value.trim();
  myLang = document.getElementById("lang").value;
  if (!name) return alert("Enter a username");

  socket = io();

  socket.emit("choose_username", { name, lang: myLang }, res => {
    if(!res.ok) return alert(res.error);

    loggedIn = true;
    document.getElementById("msg").disabled = false;
    document.getElementById("sendBtn").disabled = false;
    document.getElementById("loginSection").style.display = "none";
    appendSystem(`Joined as ${name}`);
  });

  socket.on("chat_history", msgs => {
    msgs.forEach(m => appendMessage(m.user, m.text));
  });

  socket.on("chat_message", m => appendMessage(m.user, m.text));
}

function send() {
  const msgInput = document.getElementById("msg");
  const msg = msgInput.value.trim();
  if (!msg || !loggedIn) return;
  socket.emit("send_message", { text: msg, lang: myLang });
  msgInput.value = "";
}

function appendMessage(user, text) {
  const chatDiv = document.getElementById("chat");
  const div = document.createElement("div");
  if (user === "SYSTEM") {
    div.className = "system-msg";
    div.textContent = text;
  } else {
    div.className = "chat-message";
    div.innerHTML = `<strong>${user}:</strong> ${text}`;
  }
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}

function appendSystem(text) {
  const chatDiv = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "system-msg";
  div.textContent = text;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
}
</script>

</body>
</html>
